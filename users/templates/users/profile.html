{# ~/ebi3/users/templates/users/profile.html #}
{% extends 'core/base.html' %}
{% load i18n %}

{% block title %}{% trans "Profil de" %} {{ user_profile.username }} - Ebi3{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- En-tête du profil -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card shadow">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-2 text-center">
                            <div class="avatar-circle bg-primary mb-3" style="width: 100px; height: 100px;">
                                <span class="avatar-text" style="font-size: 2.5rem;">
                                    {{ user_profile.username|first|upper }}
                                </span>
                            </div>
                        </div>
                        <div class="col-md-10">
                            <h1 class="mb-0">{{ user_profile.get_full_name|default:user_profile.username }}</h1>
                            <p class="text-muted">
                                <i class="fas fa-user-tag"></i>
                                {{ user_profile.get_role_display }}
                            </p>

                            {% if user_profile.is_verified %}
                                <span class="badge bg-success">
                                    <i class="fas fa-check-circle"></i> {% trans "Vérifié" %}
                                </span>
                            {% endif %}

                            {% if user_profile.kyc_verified %}
                                <span class="badge bg-info">
                                    <i class="fas fa-id-card"></i> {% trans "KYC Vérifié" %}
                                </span>
                            {% endif %}

                            {% if user_profile.rating > 0 %}
                                <div class="mt-2">
                                    <span class="text-warning">
                                        {% for i in "12345" %}
                                            {% if forloop.counter <= user_profile.rating %}
                                                <i class="fas fa-star"></i>
                                            {% else %}
                                                <i class="far fa-star"></i>
                                            {% endif %}
                                        {% endfor %}
                                    </span>
                                    <span class="text-muted">({{ user_profile.total_reviews }} {% trans "avis" %})</span>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Informations personnelles -->
        <div class="col-md-8">
            <div class="card shadow mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-user"></i> {% trans "Informations personnelles" %}
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>{% trans "Email :" %}</strong> {{ user_profile.email }}</p>
                            <p><strong>{% trans "Téléphone :" %}</strong> {{ user_profile.phone_number|default:"-" }}</p>
                            <p><strong>{% trans "Pays :" %}</strong> {{ user_profile.country.name|default:"-" }}</p>
                            <p><strong>{% trans "Ville :" %}</strong> {{ user_profile.city|default:"-" }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>{% trans "Membre depuis :" %}</strong> {{ user_profile.date_joined|date:"d/m/Y" }}</p>
                            <p><strong>{% trans "Langue préférée :" %}</strong> {{ user_profile.get_preferred_language_display }}</p>

                            {% if user_profile.profile %}
                                <p><strong>{% trans "Pays d'origine :" %}</strong>
                                    {{ user_profile.profile.country_of_origin.name|default:"-" }}
                                </p>
                                <p><strong>{% trans "Pays de résidence :" %}</strong>
                                    {{ user_profile.profile.country_of_residence.name|default:"-" }}
                                </p>
                            {% endif %}
                        </div>
                    </div>

                    {% if request.user == user_profile %}
                        <div class="mt-3">
                            <a href="{% url 'users:profile_edit' request.user.username %}"
                               class="btn btn-outline-primary">
                                <i class="fas fa-edit"></i> {% trans "Modifier le profil" %}
                            </a>

                            <a href="{% url 'users:profile_edit_extended' request.user.username %}"
                               class="btn btn-outline-secondary">
                                <i class="fas fa-info-circle"></i> {% trans "Informations supplémentaires" %}
                            </a>

                            <a href="{% url 'users:change_password' %}"
                               class="btn btn-outline-warning">
                                <i class="fas fa-key"></i> {% trans "Changer le mot de passe" %}
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Pour les transporteurs -->
            {% if user_profile.is_carrier %}
                <div class="card shadow mb-4">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-truck"></i> {% trans "Informations Transporteur" %}
                        </h5>
                    </div>
                    <div class="card-body">
                        {% if user_profile.profile.company_name %}
                            <p><strong>{% trans "Entreprise :" %}</strong> {{ user_profile.profile.company_name }}</p>
                        {% endif %}

                        {% if user_profile.is_available %}
                            <span class="badge bg-success">
                                <i class="fas fa-check"></i> {% trans "Disponible pour des missions" %}
                            </span>
                        {% else %}
                            <span class="badge bg-secondary">
                                <i class="fas fa-times"></i> {% trans "Indisponible" %}
                            </span>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="col-md-4">
            <!-- Vérifications -->
            <div class="card shadow mb-4">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-shield-alt"></i> {% trans "Vérifications" %}
                    </h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {% trans "Email" %}
                            {% if user_profile.email_verified %}
                                <span class="badge bg-success">
                                    <i class="fas fa-check-circle"></i>
                                </span>
                            {% else %}
                                <span class="badge bg-warning">
                                    <i class="fas fa-exclamation-circle"></i>
                                </span>
                            {% endif %}
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {% trans "Téléphone" %}
                            {% if user_profile.phone_verified %}
                                <span class="badge bg-success">
                                    <i class="fas fa-check-circle"></i>
                                </span>
                            {% else %}
                                <span class="badge bg-warning">
                                    <i class="fas fa-exclamation-circle"></i>
                                </span>
                            {% endif %}
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {% trans "KYC" %}
                            {% if user_profile.kyc_verified %}
                                <span class="badge bg-success">
                                    <i class="fas fa-check-circle"></i>
                                </span>
                            {% else %}
                                <span class="badge bg-danger">
                                    <i class="fas fa-times-circle"></i>
                                </span>
                            {% endif %}
                        </li>
                    </ul>

                    {% if request.user == user_profile and not user_profile.kyc_verified %}
                        <div class="mt-3">
                            <a href="{% url 'users:kyc_verification' %}"
                               class="btn btn-primary btn-sm w-100">
                                <i class="fas fa-id-card"></i> {% trans "Vérifier mon identité" %}
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Statistiques -->
            <div class="card shadow">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-bar"></i> {% trans "Statistiques" %}
                    </h5>
                </div>
                <div class="card-body">
                    {% if user_profile.profile %}
                        <div class="text-center">
                            <h3>{{ user_profile.profile.successful_transactions }}</h3>
                            <p class="text-muted">{% trans "Transactions réussies" %}</p>

                            <h3>{{ user_profile.profile.total_ads }}</h3>
                            <p class="text-muted">{% trans "Annonces publiées" %}</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.avatar-circle {
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
}

.avatar-text {
    line-height: 1;
}
</style>
{% endblock %}