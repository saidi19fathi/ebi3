{# ~/ebi3/carriers/templates/carriers/partials/carrier_card.html #}
{% load i18n %}
<div class="card carrier-card h-100">
    <div class="card-body">
        <!-- En-tête avec avatar et informations -->
        <div class="d-flex align-items-start mb-3">
            <div class="flex-shrink-0">
                <div class="carrier-avatar bg-primary text-white d-flex align-items-center justify-content-center">
                    <span style="font-size: 1.5rem; font-weight: bold;">
                        {{ carrier.user.username|first|upper }}
                    </span>
                </div>
            </div>
            <div class="flex-grow-1 ms-3">
                <h5 class="card-title mb-1">
                    <a href="{% url 'carriers:carrier_detail' carrier.user.username %}"
                       class="text-decoration-none text-dark">
                        {% if carrier.carrier_type == 'PROFESSIONAL' and carrier.company_name %}
                            {{ carrier.company_name }}
                        {% else %}
                            {{ carrier.user.username }}
                        {% endif %}
                    </a>
                </h5>

                <div class="d-flex flex-wrap gap-1 mb-2">
                    <span class="carrier-type-badge badge
                                {% if carrier.carrier_type == 'PROFESSIONAL' %}bg-primary
                                {% else %}bg-info{% endif %}">
                        {{ carrier.get_carrier_type_display }}
                    </span>

                    <span class="badge bg-secondary">
                        <i class="fas fa-car"></i> {{ carrier.get_vehicle_type_display }}
                    </span>

                    {% if carrier.verification_level >= 3 %}
                        <span class="badge bg-success">
                            <i class="fas fa-check-circle"></i> {% trans "Vérifié" %}
                        </span>
                    {% endif %}
                </div>

                <!-- Note -->
                <div class="rating-stars mb-2">
                    {% for i in "12345" %}
                        {% if forloop.counter <= carrier.average_rating %}
                            <i class="fas fa-star"></i>
                        {% else %}
                            <i class="far fa-star"></i>
                        {% endif %}
                    {% endfor %}
                    <small class="text-muted ms-1">
                        ({{ carrier.average_rating|floatformat:1 }})
                    </small>
                </div>
            </div>
        </div>

        <!-- Capacités -->
        <div class="mb-3">
            <div class="row g-2">
                <div class="col-6">
                    <div class="capacity-badge p-2 rounded text-center">
                        <small class="d-block text-muted">{% trans "Poids max" %}</small>
                        <strong>{{ carrier.max_weight }} kg</strong>
                    </div>
                </div>
                <div class="col-6">
                    <div class="capacity-badge p-2 rounded text-center">
                        <small class="d-block text-muted">{% trans "Volume max" %}</small>
                        <strong>{{ carrier.max_volume }} m³</strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- Services -->
        <div class="mb-3">
            <small class="text-muted d-block mb-1">{% trans "Services inclus :" %}</small>
            <div class="d-flex flex-wrap gap-1">
                {% if carrier.provides_insurance %}
                    <span class="badge bg-success">
                        <i class="fas fa-shield-alt"></i> {% trans "Assurance" %}
                    </span>
                {% endif %}
                {% if carrier.provides_packaging %}
                    <span class="badge bg-info">
                        <i class="fas fa-box"></i> {% trans "Emballage" %}
                    </span>
                {% endif %}
                {% if carrier.provides_loading %}
                    <span class="badge bg-warning">
                        <i class="fas fa-arrow-up"></i> {% trans "Chargement" %}
                    </span>
                {% endif %}
                {% if carrier.provides_unloading %}
                    <span class="badge bg-warning">
                        <i class="fas fa-arrow-down"></i> {% trans "Déchargement" %}
                    </span>
                {% endif %}
            </div>
        </div>

        <!-- Routes disponibles -->
        {% with carrier.routes.all|slice:":2" as recent_routes %}
            {% if recent_routes %}
                <div class="mb-3">
                    <small class="text-muted d-block mb-1">{% trans "Prochains départs :" %}</small>
                    <div class="route-item">
                        {% for route in recent_routes %}
                            <div class="mb-1">
                                <small>
                                    <i class="fas fa-map-marker-alt text-danger"></i>
                                    {{ route.start_city }} →
                                    <i class="fas fa-map-marker-alt text-success"></i>
                                    {{ route.end_city }}
                                    <br>
                                    <i class="fas fa-calendar text-primary"></i>
                                    {{ route.departure_date|date:"d/m/Y" }}
                                </small>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        {% endwith %}

        <!-- Pied de carte -->
        <div class="mt-auto">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <small class="text-muted">
                        <i class="fas fa-euro-sign"></i>
                        {{ carrier.base_price_per_km }} {% trans "/km" %}
                    </small>
                </div>

                <div>
                    <small class="text-muted">
                        <i class="fas fa-tasks"></i>
                        {{ carrier.completed_missions }} {% trans "missions" %}
                    </small>
                </div>
            </div>

            <div class="d-grid mt-3">
                <a href="{% url 'carriers:carrier_detail' carrier.user.username %}"
                   class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-eye"></i> {% trans "Voir profil" %}
                </a>
            </div>
        </div>
    </div>
</div>